clear all
close all
clc

nFibers1D = 16;
%nFibers1D = 1;
numFibers = nFibers1D*nFibers1D;

x = [1:nFibers1D]*2/nFibers1D-1/nFibers1D-1;
y = [1:nFibers1D]*2/nFibers1D-1/nFibers1D-1;
%x = [-0.05,0.05];
%y = [-0.05,0.05];
%x = 0.1;
%y = 0.1'
r = ones(numFibers,1)*0.9*1/nFibers1D               % Make the fiber diameter 90% of the "fiber grid unit"
%r = ones(numFibers,1)*0.045;
f = ones(numFibers,1)*0.9;                          % The g-ratio

for (i = 1:nFibers1D)
    for (j = 1:nFibers1D)
        points{(i-1)*nFibers1D+j} = [x(j) y(i) -1; x(j) y(i) 0; x(j) y(i) 1];
    end
end

% x = [0];
% y = [0];
% r = [0.015];
% points{1} = ([x(1) y(1) -1; x(1) y(1) 0; x(1) y(1) 1]);
% f(1) = 0.8;
% i = 2;
% 
% while (i <= numFibers)
%     x_i = 2*(rand-0.5);
%     y_i = 2*(rand-0.5);
%     r_i = 0.04*rand+0.01;
%     
%     if ( ((x-x_i).^2+(y-y_i).^2 > (r+r_i).^2) & (max(abs([x_i+r_i x_i-r_i y_i+r_i y_i-r_i]))<1) )
%         x(i) = x_i;
%         y(i) = y_i;
%         r(i) = r_i;
%         points{i} = ([x_i y_i -1; x_i y_i 0; x_i y_i 1]);
%         f(i) = 0.8;
%         i = i+1;
%     end
% end


%load fibers1350

write2File = true;

% theta = [0:2*pi/20:2*pi];
% figure(3)
% hold on
% for (i = 1:numFibers)
%     plot(x(i)+r(i)*cos(theta),y(i)+r(i)*sin(theta));
% end
% hold off
% axis([-1 1 -1 1])
% axis equal

% The following code is for scaling and rotating your fibers - just leave
% commented out if no changes needed to the fibers
ss = 60;                                        % Space scaling factor for fiber radii
S = [ss 0 0; 0 ss 0; 0 0 ss];                    % Matrix for scaling the fibers in x, y or z direction
% %R = rotationMatrix(-pi/4,pi/2,atan(sqrt(2)));        % Matrix for rotating the fibers - see function doc
R = [1,0,0;0,1,0;0,0,1];
for (fiber=1:numFibers)
    points{fiber} = (R*S*points{fiber}')';
    r(fiber) = ss*r(fiber);
end

M = 2;                  % Number of points that define spline
N = 12;                  % Number of points that define cross section
closed = true;          % Whether we close the fibers at the ends

totalTriangles = [];
totalVertices = [];
axonTri = [];
myelinTri = [];
%triAxons = [];          % Have stopped using this
%triMyelin = [];         % Have stopped using this
%n = 0;
maxTriMembrane = 0;


% Construct axon no. n
for (n=0:numFibers-1)
    [fiber_rc{n+1}, Xc{n+1}, Yc{n+1}, Zc{n+1}, trianglesc] = fiberTriangles(points{n+1},M,N,f(n+1)*r(n+1),closed);

    [T,V] = makeTriStd(trianglesc);
    %axonTri = [axonTri ; [size(totalTriangles,1):size(totalTriangles,1)+size(T,1)-1]' ];
    axonTri{n+1} = [size(totalTriangles,1):size(totalTriangles,1)+size(T,1)-1]';
    totalTriangles = [totalTriangles ; T - 1 + size(totalVertices,1)];
    totalVertices = [totalVertices ; V];
    %triAxons = [triAxons ; n*ones(size(T,1),1)];
    if (size(T,1) > maxTriMembrane)
        maxTriMembrane = size(T,1);
    end


    % Construct myelin no. n
    [fiber_rm{n+1}, Xm{n+1}, Ym{n+1}, Zm{n+1}, trianglesm] = fiberTriangles(points{n+1},M,N,r(n+1),closed);

    [T,V] = makeTriStd(trianglesm);
    %myelinTri = [myelinTri ; [size(totalTriangles,1):size(totalTriangles,1)+size(T,1)-1]' ];
    myelinTri{n+1} = [size(totalTriangles,1):size(totalTriangles,1)+size(T,1)-1]';
    totalTriangles = [totalTriangles ; T - 1 + size(totalVertices,1)];
    totalVertices = [totalVertices ; V];
    %triMyelin = [triMyelin ; n*ones(size(T,1),1)];
    if (size(T,1) > maxTriMembrane)
        maxTriMembrane = size(T,1);
    end
end



% Calculate the fraction of volume occupied by axons/myelin (only works for
% cylindrical fibers)

startBox = 0.06;
volumeFractionAxons = sum(0.5*(f.*r).^2*sin(2*pi/N)*N)/(startBox*2*ss)^2;
volumeFractionMyelin = sum(0.5*r.^2*sin(2*pi/N)*N)/(startBox*2*ss)^2 - volumeFractionAxons;


disp(['Fraction of spins in axons should be about ', num2str(volumeFractionAxons*100), '%']);
disp(['Fraction of spins in myelin should be about ', num2str(volumeFractionMyelin*100), '%']);


% fid = fopen('sim.triangles_17','w');
if (write2File)
    fid = fopen(['sim.fibers_',num2str(numFibers)],'w');
    
    %fprintf(fid,'Number_of_vertices\n');
    %fprintf(fid,'%0.0i\n',size(totalVertices,1));
    %fprintf(fid,'Number_of_triangles\n');
    %fprintf(fid,'%0.0i\n',size(totalTriangles,1));
    %fprintf(fid,'Number_of_membrane_types\n');
    %fprintf(fid,'%0.0i\n',2);
    %fprintf(fid,'Number_of_fibers\n');
    %fprintf(fid,'%0.0i\n',numFibers);
    %fprintf(fid,'Max_triangles_on_membrane\n');
    %fprintf(fid,'%0.0i\n',maxTriMembrane);
    %fprintf(fid,'\n');
    fprintf(fid,'V\n');
    fprintf(fid,'%9.4g %9.4g %9.4g\n', totalVertices');
    fprintf(fid,'T\n');
    fprintf(fid,'%5.1i %5.1i %5.1i\n', totalTriangles');
    for (n=0:numFibers-1)
        fprintf(fid,['A',num2str(n),'\n']);
        fprintf(fid,'%5.1i\n',axonTri{n+1}');
        fprintf(fid,['M',num2str(n),'\n']);
        fprintf(fid,'%5.1i\n',myelinTri{n+1}');
    end

    fclose(fid);
end




%save axons.txt axonTri -ascii
%save myelin.txt myelinTri -ascii
%save triangles.txt totalTriangles -ascii
%save vertices.txt totalVertices -ascii

%save tri2Axons.txt triAxons -ascii
%save tri2Myelin.txt triMyelin -ascii


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Testing all sorts of stuff
% 


testPath = [[0.078,0.078,0.5777]
[0.0754535,0.0770906,0.57825]
[0.0766425,0.0793636,0.578937]
[0.0801695,0.078846,0.582731]
[0.0819207,0.0802682,0.584166]
[0.0829116,0.0791643,0.58622]
[0.0822239,0.0830134,0.585387]
[0.0782731,0.0814805,0.585507]
[0.0782595,0.0825199,0.583908]
[0.0767845,0.0829632,0.585446]
% Step Count: 30, Time step: 0.005, MR Signal: 0.9994, ms: 0.15 
[0.0746541,0.0861073,0.585192]
[0.0733204,0.0859912,0.588319]
[0.0762286,0.0860052,0.589634]
[0.0752999,0.087194,0.5894]
[0.0745552,0.0880802,0.590084]
[0.0751384,0.0906306,0.590158]
[0.0735931,0.0878955,0.588749]
[0.0722995,0.0909347,0.591052]
[0.0721996,0.0910901,0.59289]
[0.0729962,0.08421,0.593872]
% Step Count: 40, Time step: 0.005, MR Signal: 0.9987, ms: 0.20 
[0.0770944,0.0793916,0.597421]
[0.0719059,0.0789378,0.596584]
[0.0709049,0.0818837,0.597713]
[0.0689694,0.0822201,0.599632]
[0.0725271,0.0795409,0.597145]
[0.0767277,0.0783551,0.598243]
[0.0743672,0.0793101,0.596406]
[0.0738948,0.0774047,0.602055]
[0.0760051,0.0798727,0.601813]
[0.0823909,0.0786721,0.600866]
% Step Count: 50, Time step: 0.005, MR Signal: 0.9981, ms: 0.25 
[0.0843204,0.0785914,0.597339]
[0.0843415,0.079746,0.599483]
[0.0851207,0.082216,0.603835]
[0.0833461,0.0822667,0.60491]
[0.0850574,0.0815192,0.606369]
[0.0837015,0.0841366,0.608698]
[0.0842475,0.0829003,0.605565]
[0.082352,0.0800676,0.607346]
[0.0809279,0.0775901,0.607617]
[0.0816108,0.0767955,0.608518]
% Step Count: 60, Time step: 0.005, MR Signal: 0.9975, ms: 0.30 
[0.0782918,0.0814049,0.610587]
[0.0775039,0.081519,0.611385]
[0.0811317,0.0837625,0.611655]
[0.0836119,0.0820673,0.613924]
[0.0830014,0.0812979,0.61736]
[0.0806177,0.0798236,0.612756]
[0.0855415,0.0809215,0.612469]
[0.086549,0.0761952,0.614647]
[0.0817561,0.0765974,0.614339]
[0.0788436,0.0734577,0.614535]
% Step Count: 70, Time step: 0.005, MR Signal: 0.9969, ms: 0.35 
[0.0794971,0.0750722,0.617666]
[0.0754431,0.0762517,0.61903]
[0.0766959,0.0758948,0.621193]
[0.0797444,0.0765092,0.617015]
[0.0814211,0.0784855,0.617729]
[0.078203,0.0790528,0.618679]
[0.0787385,0.0787811,0.620831]
[0.0771713,0.0793138,0.623621]
[0.0751225,0.0791141,0.625889]
[0.0771412,0.0750491,0.625203]
% Step Count: 80, Time step: 0.005, MR Signal: 0.9962, ms: 0.40 
[0.0784133,0.0752688,0.62308]
[0.0773824,0.0752306,0.623413]
[0.0774855,0.0785967,0.621302]
[0.0820281,0.0786286,0.621406]
[0.0810388,0.075682,0.621051]
[0.0805046,0.0777334,0.625935]
[0.0821419,0.0784821,0.623626]
[0.0814707,0.0790232,0.621586]
[0.0834024,0.0825893,0.620182]
[0.0815587,0.0791987,0.622037]
% Step Count: 90, Time step: 0.005, MR Signal: 0.9956, ms: 0.45 
[0.0785262,0.0828427,0.621924]
[0.0810762,0.0846248,0.620142]
[0.0791759,0.0851061,0.618906]
[0.0825574,0.0903701,0.614948]
[0.0819546,0.0884046,0.614489]
[0.0777941,0.0900397,0.612004]
[0.0780514,0.0919518,0.612659]
[0.0727443,0.0992857,0.613274]
[0.0712076,0.0980454,0.615719]
[0.0751529,0.0981866,0.61668]
% Step Count: 100, Time step: 0.005, MR Signal: 0.9950, ms: 0.50 
[0.0733034,0.0985823,0.613713]
[0.0717291,0.099497,0.616403]
[0.0745733,0.100778,0.615398]
[0.0737693,0.100355,0.613218]
[0.0703208,0.0988447,0.612004]
[0.0703203,0.10149,0.614414]
[0.0701468,0.102857,0.616966]
[0.0715372,0.105899,0.613611]
[0.0713174,0.109411,0.612253]
[0.0709423,0.111104,0.615427]
% Step Count: 110, Time step: 0.005, MR Signal: 0.9943, ms: 0.55 
[0.0737821,0.107741,0.613076]
[0.0758607,0.110979,0.612172]
[0.0796731,0.116549,0.612571]
[0.0813309,0.118638,0.611583]
[0.0829375,0.114692,0.612032]
[0.0790577,0.113086,0.609447]
[0.0807316,0.116754,0.611495]
[0.0827438,0.117457,0.613956]
[0.0828385,0.115672,0.611691]
[0.0828908,0.116694,0.606319]
% Step Count: 120, Time step: 0.005, MR Signal: 0.9937, ms: 0.60 
[0.0814842,0.118289,0.610008]
[0.0823875,0.115997,0.612162]
[0.0863721,0.116802,0.611809]
[0.085377,0.114539,0.611406]
[0.0850535,0.116121,0.609064]
[0.080504,0.118669,0.606508]
[0.0801151,0.118829,0.608104]
[0.0761373,0.123164,0.611555]
[0.0792909,0.124242,0.615805]
[0.0816927,0.121234,0.621094]
% Step Count: 130, Time step: 0.005, MR Signal: 0.9931, ms: 0.65 
[0.0870043,0.11678,0.619318]
[0.0885534,0.118522,0.625695]
[0.0900853,0.121005,0.620799]
[0.0958403,0.122891,0.619754]
[0.0934798,0.125463,0.618501]
[0.091985,0.128848,0.623921]
[0.0937336,0.12954,0.625373]
[0.0946942,0.128997,0.624427]
[0.0958325,0.129595,0.624241]
[0.100268,0.126018,0.624854]
% Step Count: 140, Time step: 0.005, MR Signal: 0.9925, ms: 0.70 
[0.0956862,0.12316,0.626337]
[0.094041,0.125751,0.623094]
[0.0923228,0.123763,0.620193]
[0.0906072,0.123868,0.620657]
[0.0896056,0.119018,0.622341]
[0.0866055,0.120845,0.623672]
[0.0911093,0.120974,0.619731]
[0.0921175,0.117187,0.620851]
[0.0903774,0.118778,0.621652]
[0.0900044,0.122177,0.619771]
% Step Count: 150, Time step: 0.005, MR Signal: 0.9918, ms: 0.75 
[0.0854493,0.123978,0.620722]
[0.0875067,0.12151,0.61783]
[0.0852225,0.120347,0.614684]
[0.0881026,0.121433,0.611496]
[0.0882474,0.120152,0.611314]
[0.0857159,0.120473,0.610752]
[0.0861635,0.121658,0.610413]
[0.088607,0.117829,0.609379]
[0.0859533,0.116554,0.611762]
[0.0805833,0.11259,0.610395]
% Step Count: 160, Time step: 0.005, MR Signal: 0.9912, ms: 0.80 
[0.0797249,0.109218,0.609871]
[0.0813699,0.104828,0.61175]
[0.082668,0.107437,0.607103]
[0.0810736,0.104907,0.607242]
[0.083669,0.108141,0.605225]
[0.0795339,0.106873,0.604592]
[0.0732957,0.106037,0.601442]
[0.070201,0.104296,0.598122]
[0.0758974,0.105659,0.598425]
[0.077531,0.10762,0.600244]
% Step Count: 170, Time step: 0.005, MR Signal: 0.9906, ms: 0.85 
[0.0754095,0.103088,0.601763]
[0.0807295,0.105412,0.603559]
[0.0825533,0.106043,0.597795]
[0.0810911,0.103229,0.59641]
[0.0845164,0.107129,0.595458]
[0.084302,0.110639,0.598642]
[0.0809415,0.115782,0.598248]
[0.0790129,0.115777,0.598858]
[0.081219,0.115789,0.596515]
[0.0809861,0.114225,0.597558]
% Step Count: 180, Time step: 0.005, MR Signal: 0.9900, ms: 0.90 
[0.0767633,0.114064,0.59554]
[0.0763286,0.114296,0.591578]
[0.076468,0.114804,0.591439]
[0.0799749,0.110856,0.591749]
[0.080324,0.108506,0.590662]
[0.0805332,0.111047,0.592282]
[0.0790244,0.109885,0.596795]
[0.0800751,0.109751,0.593971]
[0.0822194,0.11019,0.591615]
[0.0793563,0.10455,0.590877]
% Step Count: 190, Time step: 0.005, MR Signal: 0.9893, ms: 0.95 
[0.0802243,0.104479,0.592587]
[0.0844815,0.106437,0.592902]
[0.0873973,0.105732,0.595436]
[0.0892318,0.108637,0.592936]
[0.0900397,0.103051,0.595329]
[0.0922816,0.101781,0.595184]
[0.0964915,0.100347,0.596814]
[0.0947435,0.101567,0.601438]
[0.0944766,0.101843,0.606277]
[0.0949137,0.0981879,0.606084]
% Step Count: 200, Time step: 0.005, MR Signal: 0.9887, ms: 1.00 
[0.0948582,0.0973372,0.60343]
[0.0942734,0.097421,0.605556]
[0.0948603,0.101097,0.60432]
[0.0955075,0.10077,0.605738]
[0.100782,0.101276,0.6033]
[0.100132,0.0963947,0.604802]
[0.0965376,0.0995231,0.608642]
[0.0971661,0.101118,0.610168]
[0.101708,0.101212,0.612062]
[0.100601,0.103765,0.611658]
% Step Count: 210, Time step: 0.005, MR Signal: 0.9881, ms: 1.05 
[0.0982674,0.103748,0.612093]
[0.101035,0.104608,0.616371]
[0.0977547,0.105429,0.617836]
[0.0955135,0.103443,0.617022]
[0.0949305,0.101134,0.622134]
[0.0945197,0.0996002,0.624137]
[0.0970715,0.0973514,0.620458]
[0.099952,0.0945439,0.62062]
[0.096203,0.0924722,0.617884]
[0.0998104,0.0927414,0.617249]
% Step Count: 220, Time step: 0.005, MR Signal: 0.9875, ms: 1.10 
[0.0973668,0.0927341,0.616147]
[0.0981869,0.0908722,0.615382]
[0.0977319,0.0893051,0.613904]
[0.0975217,0.0882037,0.61476]
[0.0984825,0.0874303,0.619832]
[0.0981746,0.0837902,0.621626]
[0.0964998,0.0825523,0.623346]
[0.0935307,0.0824815,0.62213]
[0.0902706,0.082937,0.61936]
[0.0885281,0.0831676,0.623894]
% Step Count: 230, Time step: 0.005, MR Signal: 0.9868, ms: 1.15 
[0.0864697,0.0834711,0.628947]
[0.0845139,0.0842819,0.627911]
[0.0857987,0.0826106,0.629313]
[0.087515,0.0803186,0.626926]
[0.0859515,0.0775578,0.627903]
[0.0914715,0.0816894,0.623325]
[0.093016,0.0832528,0.620136]
[0.0940474,0.0822799,0.624353]
[0.0899684,0.0787537,0.619009]
[0.0878603,0.0766738,0.61702]
% Step Count: 240, Time step: 0.005, MR Signal: 0.9862, ms: 1.20 
[0.0893074,0.0790524,0.616327]
[0.0885567,0.0779093,0.616486]
[0.0879927,0.0804619,0.619445]
[0.0860496,0.0834023,0.616669]
[0.0860404,0.0809145,0.615855]
[0.0900528,0.0799022,0.616593]
[0.0887723,0.0812778,0.617403]
[0.0880109,0.0780519,0.621241]
[0.0886946,0.0785359,0.621938]
[0.0860516,0.08042,0.62449]];

testPath2 = [[0.075,0.07,0.0360976]
[0.074233,0.0697486,0.0367824]
[0.0735979,0.069704,0.037039]
[0.073603,0.0701297,0.0379111]
[0.074232,0.0693152,0.0381474]
[0.0746767,0.0692481,0.0384163]
[0.0745198,0.0691957,0.0380753]
[0.0746037,0.0692347,0.0384946]
[0.0750979,0.069433,0.0383972]
[0.0752677,0.0699964,0.037686]
% Step Count: 30, Time step: 0.005, MR Signal: 0.9994, ms: 0.15 
[0.0747838,0.0694616,0.0377945]
[0.0749758,0.0688738,0.0376534]
[0.0745457,0.0681452,0.037799]
[0.073542,0.0683932,0.0386281]
[0.0737252,0.0685189,0.0385754]
[0.0737489,0.068356,0.03777]
[0.0736256,0.0691105,0.0384058]
[0.0736745,0.0687176,0.0379612]
[0.0747154,0.0685868,0.0376388]
[0.0749324,0.0693955,0.037697]
% Step Count: 40, Time step: 0.005, MR Signal: 0.9987, ms: 0.20 
[0.0748364,0.0691979,0.036964]
[0.0754097,0.0686255,0.0371842]
[0.0749805,0.0695926,0.0371386]
[0.0759277,0.0700963,0.0370322]
[0.0764701,0.0702584,0.0367161]
[0.0770817,0.0700758,0.0365247]
[0.0769993,0.0702243,0.0371585]
[0.0774701,0.0699499,0.0365999]
[0.0782273,0.0698465,0.0369217]
[0.0790998,0.0704473,0.0382047]
% Step Count: 50, Time step: 0.005, MR Signal: 0.9981, ms: 0.25 
[0.0794274,0.0705529,0.0377797]
[0.0791231,0.0708801,0.0377956]
[0.0800663,0.0702888,0.0373135]
[0.0803005,0.0694135,0.037476]
[0.0800552,0.070262,0.0370754]
[0.0800445,0.069426,0.0362632]
[0.0800529,0.0684008,0.0355576]
[0.0803304,0.0686525,0.0355107]
[0.0799854,0.0695237,0.0360277]
[0.0808553,0.0696069,0.0355646]
% Step Count: 60, Time step: 0.005, MR Signal: 0.9975, ms: 0.30 
[0.0815969,0.0684821,0.0361975]
[0.081676,0.0678425,0.0361645]
[0.0813599,0.0672352,0.036461]
[0.0809535,0.0668103,0.036144]
[0.0809342,0.0665938,0.0358116]
[0.0811805,0.0657566,0.0361347]
[0.0813144,0.0660744,0.0359944]
[0.0818587,0.0662273,0.0356623]
[0.0818236,0.0660166,0.034718]
[0.0823019,0.0664586,0.0342923]
% Step Count: 70, Time step: 0.005, MR Signal: 0.9968, ms: 0.35 
[0.081158,0.0672086,0.0338436]
[0.081717,0.0676355,0.0334426]
[0.0824345,0.0680775,0.0339278]
[0.0832424,0.0682543,0.0331817]
[0.0828666,0.0681959,0.0330919]
[0.0832094,0.0683919,0.0327988]
[0.0821557,0.0686151,0.0329591]
[0.0820736,0.068529,0.0328657]
[0.0823076,0.0680305,0.03295]
[0.0822087,0.0673544,0.0324855]
% Step Count: 80, Time step: 0.005, MR Signal: 0.9962, ms: 0.40 
[0.0822633,0.0673505,0.0330529]
[0.0816592,0.0681426,0.0331249]
[0.0820988,0.0677079,0.0336444]
[0.0819134,0.0676177,0.0333588]
[0.0824878,0.0674467,0.0329931]
[0.0837268,0.0674398,0.032395]
[0.0840144,0.0675221,0.0326337]
[0.0839402,0.0673175,0.0323209]
[0.0837897,0.0676289,0.0323414]
[0.0846058,0.067723,0.0335347]
% Step Count: 90, Time step: 0.005, MR Signal: 0.9956, ms: 0.45 
[0.0844658,0.0678627,0.0339989]
[0.0845178,0.0665687,0.0337142]
[0.0836965,0.0675986,0.0337922]
[0.0836992,0.0668174,0.0335609]
[0.0837182,0.0670326,0.0343138]
[0.0828021,0.0673188,0.0350773]
[0.0832996,0.067744,0.0361257]
[0.0832145,0.0674431,0.035153]
[0.0845354,0.0669511,0.034467]
[0.0848226,0.0665667,0.0343124]
% Step Count: 100, Time step: 0.005, MR Signal: 0.9949, ms: 0.50 
[0.0856246,0.0666346,0.034837]
[0.0853836,0.0661041,0.0349338]
[0.0855463,0.0670528,0.0343032]
[0.0856706,0.0675835,0.0337215]
[0.0858887,0.0671573,0.0341277]
[0.0855525,0.0666567,0.033783]
[0.0859519,0.066929,0.034662]
[0.084996,0.0672422,0.0349075]
[0.0853514,0.0678672,0.0359117]
[0.0854663,0.0676048,0.0355543]
% Step Count: 110, Time step: 0.005, MR Signal: 0.9943, ms: 0.55 
[0.0857496,0.0671918,0.0362941]
[0.0853423,0.0667078,0.0361759]
[0.0846156,0.0666802,0.0357228]
[0.0844165,0.0661426,0.0353406]
[0.0848754,0.0660012,0.0346967]
[0.085141,0.0655042,0.0345375]
[0.085356,0.0652245,0.0329013]
[0.0852966,0.0649915,0.0323185]
[0.0851574,0.064639,0.0321434]
[0.0846179,0.063942,0.0317988]
% Step Count: 120, Time step: 0.005, MR Signal: 0.9937, ms: 0.60 
[0.0840591,0.0637415,0.0315133]
[0.0843031,0.0642383,0.0314235]
[0.0845194,0.0648779,0.0315686]
[0.0834135,0.0651866,0.031879]
[0.0834456,0.0658597,0.0316027]
[0.0833572,0.0648695,0.0319792]
[0.0829259,0.0646152,0.0324665]
[0.082844,0.0648225,0.0323393]
[0.083246,0.0649038,0.0324799]
[0.083336,0.0650636,0.0325156]
% Step Count: 130, Time step: 0.005, MR Signal: 0.9931, ms: 0.65 
[0.0839405,0.0651065,0.0327657]
[0.0833575,0.0640326,0.0333671]
[0.0820464,0.0638048,0.0338259]
[0.0810935,0.0637732,0.0349397]
[0.0811313,0.0631844,0.0351666]
[0.0818309,0.0625994,0.0349379]
[0.0821962,0.0627601,0.0344095]
[0.0818788,0.0622353,0.0342279]
[0.0818915,0.0619735,0.0352187]
[0.0809598,0.0620158,0.0354597]
% Step Count: 140, Time step: 0.005, MR Signal: 0.9924, ms: 0.70 
[0.0810957,0.0622096,0.0350907]
[0.081392,0.0617455,0.034861]
[0.0814634,0.0606151,0.0352826]
[0.0821841,0.0613463,0.0345349]
[0.0823375,0.0620105,0.0343016]
[0.0830951,0.0617741,0.0351187]
[0.0839762,0.0613741,0.0356065]
[0.0844508,0.0613395,0.035296]
[0.0844348,0.0624698,0.0356754]
[0.0849236,0.0622807,0.0355386]
% Step Count: 150, Time step: 0.005, MR Signal: 0.9918, ms: 0.75 
[0.0860917,0.0622181,0.0354213]
[0.0855939,0.0623353,0.0352744]
[0.0857426,0.0620108,0.0350023]
[0.0850792,0.0623189,0.0352597]
[0.0843815,0.0621635,0.0353914]
[0.0845948,0.0626439,0.0357566]
[0.0843241,0.062638,0.0353214]
[0.08412,0.0626778,0.0343345]
[0.0839709,0.0627554,0.0344748]
[0.0840643,0.0629729,0.034515]
% Step Count: 160, Time step: 0.005, MR Signal: 0.9912, ms: 0.80 
[0.0840774,0.0626501,0.0343906]
[0.0840302,0.0629056,0.0340055]
[0.0843806,0.0627523,0.0351082]
[0.0842109,0.0631782,0.0348344]
[0.0843251,0.0626623,0.0349956]
[0.08469,0.0621896,0.0341958]
[0.0851997,0.0625326,0.0341205]
[0.0857253,0.0623998,0.0346347]
[0.0858503,0.0628614,0.0349723]
[0.0858297,0.062733,0.0365542]
% Step Count: 170, Time step: 0.005, MR Signal: 0.9905, ms: 0.85 
[0.0864164,0.063,0.0355311]
[0.086451,0.0630759,0.0363408]
[0.0861477,0.0623881,0.0364855]
[0.086115,0.0634429,0.0375773]
[0.0878802,0.0629673,0.0367453]
[0.0876629,0.0626347,0.0370906]
[0.0867084,0.0624915,0.0375433]
[0.0862236,0.063513,0.0365588]
[0.0854685,0.0630478,0.0352829]
[0.0856294,0.0633368,0.0354294]
% Step Count: 180, Time step: 0.005, MR Signal: 0.9899, ms: 0.90 
[0.0846161,0.0638154,0.0353687]
[0.0832251,0.0636693,0.0359269]
[0.0840095,0.0645314,0.0360832]
[0.0841806,0.0652566,0.0362454]
[0.0843058,0.0650149,0.0365659]
[0.0840099,0.0648591,0.0369538]
[0.0831115,0.0644648,0.0367846]
[0.0832658,0.0653312,0.0361901]
[0.0824532,0.0653156,0.036123]
[0.0827028,0.0649423,0.0367429]
% Step Count: 190, Time step: 0.005, MR Signal: 0.9893, ms: 0.95 
[0.0821769,0.0642935,0.0366071]
[0.0821641,0.0640402,0.0364474]
[0.0812819,0.0648922,0.0372321]
[0.0813124,0.0649063,0.0365744]
[0.0818415,0.0650876,0.037233]
[0.0824912,0.0648151,0.0368291]
[0.0826337,0.0644481,0.0386861]
[0.0831949,0.0646901,0.0386545]
[0.0838389,0.0645108,0.038215]
[0.0835434,0.0650536,0.037893]
% Step Count: 200, Time step: 0.005, MR Signal: 0.9887, ms: 1.00 
[0.083096,0.0659701,0.0377981]
[0.0842257,0.0664199,0.0370723]
[0.0838191,0.067334,0.0377912]
[0.0833795,0.0675661,0.0374174]
[0.0831675,0.0673563,0.0376764]
[0.083113,0.0678313,0.0369037]
[0.0842409,0.0669604,0.0369689]
[0.0840649,0.0666837,0.039114]
[0.0841482,0.0661021,0.03942]
[0.0847478,0.0659845,0.0393718]
% Step Count: 210, Time step: 0.005, MR Signal: 0.9880, ms: 1.05 
[0.0849987,0.0661716,0.0396329]
[0.0843264,0.0670173,0.0397019]
[0.0839497,0.067225,0.0393803]
[0.0834083,0.0665987,0.0385581]
[0.0835623,0.0660755,0.0386489]
[0.083822,0.0666177,0.0385483]
[0.0847086,0.0665817,0.0384546]
[0.0842495,0.0671286,0.0387611]
[0.0839967,0.0670806,0.0398952]
[0.0842787,0.0671618,0.0414896]
% Step Count: 220, Time step: 0.005, MR Signal: 0.9874, ms: 1.10 
[0.0847979,0.0677865,0.0415261]
[0.0848838,0.0669175,0.0410697]
[0.0845111,0.0670916,0.0413259]
[0.0848721,0.0675416,0.0410743]
[0.0848471,0.0669825,0.040706]
[0.084406,0.0672218,0.0396223]
[0.0844888,0.0673856,0.0390004]
[0.0848978,0.067453,0.0385137]
[0.0843306,0.0676489,0.0380667]
[0.0845147,0.0667343,0.03834]
% Step Count: 230, Time step: 0.005, MR Signal: 0.9868, ms: 1.15 
[0.0843106,0.0664463,0.0376424]
[0.0840079,0.0661119,0.0373082]
[0.0841503,0.0665251,0.0377736]
[0.0843771,0.067313,0.0381054]
[0.0840857,0.0663269,0.0385846]
[0.0838762,0.0661752,0.0381908]
[0.08278,0.065948,0.0371437]
[0.0827323,0.0662054,0.0374509]
[0.083183,0.0660374,0.0377838]
[0.0829604,0.0662063,0.0379792]
% Step Count: 240, Time step: 0.005, MR Signal: 0.9862, ms: 1.20 
[0.0835479,0.0664145,0.0379693]
[0.0826459,0.0663726,0.037945]
[0.0817373,0.0668069,0.0383207]
[0.081559,0.0664819,0.0378481]
[0.081696,0.0665707,0.0373191]
[0.081601,0.0672514,0.03722]
[0.0815513,0.0673887,0.0368459]
[0.081537,0.0670806,0.0381658]
[0.0820914,0.0669522,0.0380406]
[0.0817554,0.066429,0.0376357]];

testPath3 = [[0.065,0.07,0.335346]
[0.0664123,0.068688,0.336134]
[0.0643646,0.0664957,0.338211]
[0.0616142,0.0652719,0.338051]
[0.0621043,0.0665191,0.339232]
[0.0643018,0.0638923,0.340124]
[0.0634209,0.0640502,0.338646]
[0.062252,0.0623569,0.335229]
[0.0631795,0.0588594,0.334056]
[0.0633827,0.0582582,0.335244]
% % Step Count: 30, Time step: 0.005, MR Signal: 0.9994, ms: 0.15 
[0.0623041,0.0600847,0.335862]
[0.0646694,0.0589045,0.335705]
[0.0608003,0.0575093,0.332221]
[0.0571346,0.0583192,0.330668]
[0.0530517,0.0565784,0.327629]
[0.0539033,0.0532748,0.325936]
[0.0523944,0.0516373,0.330038]
[0.0536023,0.0509576,0.32852]
[0.0478164,0.0510873,0.330491]
[0.0470529,0.0559823,0.33563]
% % Step Count: 40, Time step: 0.005, MR Signal: 0.9987, ms: 0.20 
[0.0458622,0.0595111,0.337745]
[0.0460058,0.0566852,0.335727]
[0.0480154,0.0567833,0.339788]
[0.0473265,0.0598585,0.335465]
[0.0476537,0.0600157,0.338597]
[0.0453819,0.0607717,0.339918]
[0.0447919,0.0627359,0.339153]
[0.046615,0.0609999,0.34212]
[0.0472575,0.0610906,0.339632]
[0.048745,0.0598221,0.337044]
% % Step Count: 50, Time step: 0.005, MR Signal: 0.9981, ms: 0.25 
[0.0446738,0.0559521,0.339378]
[0.043699,0.0555095,0.34035]
[0.0436183,0.0594193,0.33758]
[0.042683,0.0613501,0.336131]
[0.0447031,0.0662714,0.337964]
[0.0466027,0.0655319,0.33152]
[0.0497602,0.0611735,0.33205]
[0.0483894,0.0606569,0.330237]
[0.0517935,0.0610469,0.329147]
[0.0528326,0.0594617,0.330961]
% % Step Count: 60, Time step: 0.005, MR Signal: 0.9975, ms: 0.30 
[0.0542575,0.0599052,0.335939]
[0.0552242,0.0568621,0.341069]
[0.0522944,0.0511271,0.341291]
[0.0542656,0.0509713,0.342499]
[0.0593101,0.0487855,0.342692]
[0.0566964,0.0517816,0.344171]
[0.0521088,0.0516515,0.349441]
[0.0513875,0.053411,0.347524]
[0.0517255,0.0558426,0.34702]
[0.0444663,0.0562461,0.346846]
% % Step Count: 70, Time step: 0.005, MR Signal: 0.9968, ms: 0.35 
[0.0471395,0.0565644,0.345144]
[0.0498448,0.0545247,0.344679]
[0.0503985,0.0534593,0.345277]
[0.052658,0.0610973,0.345644]
[0.0500493,0.0583575,0.342925]
[0.0492073,0.0583283,0.342543]
[0.0476708,0.0616248,0.344329]
[0.0443144,0.0569402,0.345565]
[0.042976,0.0560455,0.349332]
[0.0482463,0.0557568,0.351205]
% % Step Count: 80, Time step: 0.005, MR Signal: 0.9962, ms: 0.40 
[0.0456247,0.0539001,0.350366]
[0.0414553,0.0536309,0.346788]
[0.0418733,0.0510534,0.343425]
[0.0430391,0.0484824,0.341865]
[0.0436883,0.0472089,0.342727]
[0.0450424,0.0446648,0.345301]
[0.0499326,0.0476086,0.346162]
[0.050034,0.0509441,0.346467]
[0.0499431,0.047176,0.344409]
[0.0481526,0.04831,0.348344]
% % Step Count: 90, Time step: 0.005, MR Signal: 0.9956, ms: 0.45 
[0.0468753,0.0483806,0.34645]
[0.0435799,0.0511751,0.346426]
[0.0449455,0.0513976,0.34843]
[0.0449398,0.0480833,0.344675]
[0.043824,0.0450325,0.34433]
[0.0449701,0.0438233,0.342869]
[0.0473091,0.0437282,0.344042]
[0.0456985,0.0440208,0.346076]
[0.0476699,0.0443339,0.343166]
[0.0503875,0.0420753,0.342502]
% % Step Count: 100, Time step: 0.005, MR Signal: 0.9950, ms: 0.50 
[0.0512067,0.0441853,0.343951]
[0.0510432,0.0452216,0.342045]
[0.0532157,0.0471027,0.342289]
[0.0497254,0.0473647,0.342393]
[0.0487506,0.0473328,0.33733]
[0.051623,0.0466071,0.33232]
[0.0572843,0.0461361,0.335291]
[0.0626097,0.0456306,0.334907]
[0.0601887,0.0456217,0.335881]
[0.0614363,0.0490228,0.335876]
% % Step Count: 110, Time step: 0.005, MR Signal: 0.9943, ms: 0.55 
[0.0635398,0.0489472,0.33991]
[0.0648981,0.0495379,0.339059]
[0.0657685,0.0492416,0.341365]
[0.0632366,0.0522154,0.344022]
[0.0625012,0.053807,0.34592]
[0.0591315,0.0549559,0.349385]
[0.0600732,0.060175,0.343626]
[0.0563574,0.0618957,0.341103]
[0.0549959,0.0639178,0.344896]
[0.0542963,0.0622954,0.346213]
% % Step Count: 120, Time step: 0.005, MR Signal: 0.9937, ms: 0.60 
[0.0520151,0.0655344,0.345791]
[0.053941,0.0664834,0.343957]
[0.0538878,0.0702598,0.346623]
[0.0539917,0.0696189,0.349417]
[0.0549498,0.0687197,0.351334]
[0.0565682,0.0700018,0.352641]
[0.0512635,0.068834,0.352562]
[0.0508631,0.0651608,0.352933]
[0.0499975,0.0658829,0.356952]
[0.0545452,0.0657558,0.360248]
% % Step Count: 130, Time step: 0.005, MR Signal: 0.9931, ms: 0.65 
[0.0526205,0.0657165,0.359093]
[0.0525596,0.0669646,0.356372]
[0.0531704,0.0662921,0.356801]
[0.0540383,0.0710777,0.353416]
[0.0561516,0.0721776,0.357959]
[0.0547507,0.0807044,0.356352]
[0.0559114,0.0787173,0.351029]
[0.053217,0.0775216,0.34553]
[0.050712,0.0733981,0.346021]
[0.0537161,0.0737453,0.34666]
% % Step Count: 140, Time step: 0.005, MR Signal: 0.9924, ms: 0.70 
[0.0541365,0.0779068,0.344971]
[0.0519447,0.0787788,0.341698]
[0.0505977,0.0766326,0.341787]
[0.0516364,0.0740988,0.343005]
[0.0526684,0.0713333,0.339966]
[0.0543102,0.0700714,0.34295]
[0.0554418,0.0688627,0.345057]
[0.0535648,0.0718785,0.344717]
[0.0507607,0.0729834,0.345681]
[0.0501045,0.0715118,0.343336]
% % Step Count: 150, Time step: 0.005, MR Signal: 0.9918, ms: 0.75 
[0.0508056,0.0740115,0.34126]
[0.0479568,0.0723058,0.338589]
[0.0499211,0.0710143,0.337961]
[0.0527753,0.0701959,0.339268]
[0.0535534,0.0739175,0.342386]
[0.0494162,0.0742248,0.341282]
[0.0483362,0.0778025,0.342367]
[0.0465285,0.0800304,0.339729]
[0.044493,0.0816219,0.335633]
[0.0470989,0.081422,0.337881]
% % Step Count: 160, Time step: 0.005, MR Signal: 0.9912, ms: 0.80 
[0.0433735,0.0797548,0.335169]
[0.0464164,0.07755,0.332162]
[0.0486706,0.0746653,0.329963]
[0.0506405,0.0772295,0.328042]
[0.0497108,0.076286,0.331236]
[0.0470089,0.0737669,0.327692]
[0.0463578,0.0736771,0.327675]
[0.0457647,0.0739285,0.333863]
[0.0417577,0.0725167,0.33512]
[0.0432915,0.071973,0.333477]
% % Step Count: 170, Time step: 0.005, MR Signal: 0.9906, ms: 0.85 
[0.0438048,0.071016,0.336791]
[0.0409599,0.0735447,0.337909]
[0.0388177,0.0764722,0.33501]
[0.0347478,0.0740916,0.331719]
[0.0335939,0.0743043,0.328877]
[0.02965,0.0753436,0.329453]
[0.0287367,0.0772758,0.329563]
[0.029278,0.077881,0.333996]
[0.0333427,0.0781625,0.335259]
[0.0337133,0.0784078,0.335897]
% % Step Count: 180, Time step: 0.005, MR Signal: 0.9899, ms: 0.90 
[0.0370468,0.0769266,0.341667]
[0.0389463,0.0781689,0.339786]
[0.0377304,0.0783431,0.341082]
[0.0396397,0.0809601,0.337582]
[0.0357172,0.0804906,0.339742]
[0.0367886,0.0780162,0.340492]
[0.0367174,0.0767322,0.342384]
[0.0347478,0.0756412,0.344753]
[0.0339067,0.0761991,0.34194]
[0.0334035,0.0803284,0.33794]
% % Step Count: 190, Time step: 0.005, MR Signal: 0.9893, ms: 0.95 
[0.0345499,0.0779974,0.331378]
[0.0310154,0.0778401,0.331207]
[0.0324984,0.0783077,0.33345]
[0.0283476,0.0782776,0.330281]
[0.0262267,0.080522,0.335867]
[0.02605,0.0840626,0.333612]
[0.0272517,0.0837905,0.332653]
[0.0262842,0.088828,0.33218]
[0.0254969,0.090345,0.328093]
[0.0242469,0.0884731,0.329827]
% % Step Count: 200, Time step: 0.005, MR Signal: 0.9887, ms: 1.00 
[0.0238065,0.0847388,0.329389]
[0.0256317,0.086168,0.332978]
[0.0272854,0.086428,0.333732]
[0.0269652,0.0852202,0.335884]
[0.0267163,0.0857035,0.333171]
[0.0249013,0.0837973,0.334177]
[0.0262898,0.0887895,0.334796]
[0.0283921,0.0887479,0.33766]
[0.0279178,0.0900702,0.337376]
[0.0210758,0.0880955,0.338204]
% % Step Count: 210, Time step: 0.005, MR Signal: 0.9881, ms: 1.05 
[0.0182703,0.091102,0.342661]
[0.0203145,0.0932565,0.341673]
[0.0191244,0.0928491,0.341984]
[0.0204579,0.0909687,0.338972]
[0.0229024,0.0915541,0.341754]
[0.023135,0.0905644,0.342582]
[0.0212505,0.0870352,0.344443]
[0.0209498,0.0856376,0.343739]
[0.0203794,0.0827956,0.342762]
[0.0195787,0.0795611,0.342646]
% % Step Count: 220, Time step: 0.005, MR Signal: 0.9874, ms: 1.10 
[0.0213699,0.0795015,0.344217]
[0.0227879,0.0809772,0.345217]
[0.0245353,0.0802355,0.34674]
[0.0259509,0.0791608,0.348534]
[0.0267745,0.0834106,0.348929]
[0.0268014,0.0848956,0.350768]
[0.0194278,0.0856801,0.35145]
[0.0216075,0.0868629,0.351936]
[0.0237263,0.0843152,0.353547]
[0.0242322,0.0863875,0.354921]
% % Step Count: 230, Time step: 0.005, MR Signal: 0.9868, ms: 1.15 
[0.0227686,0.080992,0.354458]
[0.0232463,0.0814861,0.347986]
[0.0210363,0.0826434,0.343188]
[0.0227117,0.0838647,0.345506]
[0.0249989,0.0855661,0.347717]
[0.0209151,0.0884752,0.347201]
[0.0196115,0.0875934,0.349098]
[0.0217356,0.087625,0.346739]
[0.0207868,0.0862475,0.345309]
[0.0218169,0.0892656,0.347979]
% % Step Count: 240, Time step: 0.005, MR Signal: 0.9862, ms: 1.20 
[0.0207142,0.0910537,0.345709]
[0.0188685,0.0900893,0.343733]
[0.0176065,0.0938784,0.34741]
[0.0202781,0.0907392,0.346508]
[0.0197053,0.0892937,0.344949]
[0.0179351,0.0936066,0.344768]
[0.0181878,0.0921715,0.343004]
[0.021445,0.0936468,0.342116]
[0.0195323,0.0926302,0.341177]
[0.0210016,0.0906964,0.339711]];

            
%minxyz: [0.9529,-0.3837,-0.2223]
%maxxyz: [1.013,-0.2014,-0.07082]

oPos2pos = [0.896499,0.509502,0.112588 ; 0.895659,0.512044,0.11633];
collPoint2endpos = [0.89599,0.511042,0.114855 ; 0.896601,0.512875,0.116864];

teststartPos0 = [0.621391,0.696364,-0.297724];
testendPos0 =   [0.61584,0.687064,-0.299675];
teststartPos1 = [0.621257,0.69614,-0.297771];
testendPos1 =   [0.630978,0.691991,-0.299675];
teststartPos2 = [0.777083,0.46453,0.150818];
testendPos2 =   [0.780902,0.47115,0.173341];
testray0 = [teststartPos0 ; testendPos0];
testray1 = [teststartPos1 ; testendPos1];
%testray2 = [teststartPos2 ; testendPos2];

%testPointIndex = 5;
%testPoint = totalVertices(testPointIndex+1,:)
testPoint = [0.025,0.025,0.0];

triIndex = 43;
v1Index = totalTriangles(triIndex+1,1);
v2Index = totalTriangles(triIndex+1,2);
v3Index = totalTriangles(triIndex+1,3);
v1 = totalVertices(v1Index+1,:);
v2 = totalVertices(v2Index+1,:);
v3 = totalVertices(v3Index+1,:);
tri = [v1;v2;v3;v1]

triIndex2 = 44;
v1Index2 = totalTriangles(triIndex2+1,1);
v2Index2 = totalTriangles(triIndex2+1,2);
v3Index2 = totalTriangles(triIndex2+1,3);
v12 = totalVertices(v1Index2+1,:);
v22 = totalVertices(v2Index2+1,:);
v32 = totalVertices(v3Index2+1,:);
tri2 = [v12;v22;v32;v12]

numCubes = 50;
cubeIndex = 1224;
cubex = mod(cubeIndex,numCubes);
cubey = floor(mod(cubeIndex,numCubes^2)/numCubes);
cubez = floor(cubeIndex/numCubes^2);
minPoint = [-1+cubex*2/numCubes,-1+cubey*2/numCubes,-1+cubez*2/numCubes];
maxPoint = [-1+(cubex+1)*2/numCubes,-1+(cubey+1)*2/numCubes,-1+(cubez+1)*2/numCubes];
cube = [minPoint; 
       [maxPoint(1), minPoint(2:3)]; 
       [maxPoint(1:2), minPoint(3)];
       [minPoint(1), maxPoint(2), minPoint(3)]; 
        minPoint;
       [minPoint(1:2), maxPoint(3)];
       [minPoint(1), maxPoint(2:3)];
       [minPoint(1), maxPoint(2), minPoint(3)];
       [minPoint(1), maxPoint(2:3)];
        maxPoint;
       [maxPoint(1:2), minPoint(3)];
       [maxPoint(1), minPoint(2:3)];
       [maxPoint(1),minPoint(2),maxPoint(3)];
        maxPoint;
       [maxPoint(1),minPoint(2),maxPoint(3)];
       [minPoint(1:2), maxPoint(3)]];
        
        

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%
% Plot results
%

figure(1)
hold on
for (n = 0:numFibers-1)
    plot3(fiber_rm{n+1}(1,:),fiber_rm{n+1}(2,:),fiber_rm{n+1}(3,:),'bx-', ...
    points{n+1}(:,1),points{n+1}(:,2),points{n+1}(:,3),'ro--');
end
hold off
legend('Resampled', 'Original');
axis([-ss ss -ss ss -ss ss]);
xlabel('x');
ylabel('y');
zlabel('z');
grid on

% figure(2);
% hold on
% for (n = 0:numFibers-1)
%     surf(Xm{n+1}/ss,Ym{n+1}/ss,Zm{n+1}/ss,'FaceAlpha',0.2);
%     surf(Xc{n+1}/ss,Yc{n+1}/ss,Zc{n+1}/ss,'FaceAlpha',0.4);
% end
% % surf(Xc{numFibers},Yc{numFibers},Zc{numFibers},'FaceAlpha',0.2);
% % plot3(testPoint(1),testPoint(2),testPoint(3),'mx')
% %plot3(testPathBeforeCorrection(:,1),testPathBeforeCorrection(:,2),testPathBeforeCorrection(:,3),'b-');
% plot3(testPath(:,1),testPath(:,2),testPath(:,3),'r-');
% plot3(testPath2(:,1),testPath2(:,2),testPath2(:,3),'g-');
% plot3(testPath3(:,1),testPath3(:,2),testPath3(:,3),'b-');
% % plot3(teststartPos0(1),teststartPos0(2),teststartPos0(3),'bx');
% % plot3(testendPos0(1),testendPos0(2),testendPos0(3),'bo');
% % plot3(testray0(:,1),testray0(:,2),testray0(:,3),'b');
% % plot3(teststartPos1(1),teststartPos1(2),teststartPos1(3),'gx');
% % plot3(testendPos1(1),testendPos1(2),testendPos1(3),'go');
% % plot3(testray1(:,1),testray1(:,2),testray1(:,3),'g');
% % plot3(teststartPos2(1),teststartPos2(2),teststartPos2(3),'kx');
% % plot3(testendPos2(1),testendPos2(2),testendPos2(3),'ko');
% % plot3(testray2(:,1),testray2(:,2),testray2(:,3),'k');
% % plot3(cube(:,1),cube(:,2),cube(:,3),'m');
% % plot3(tri(:,1)/ss,tri(:,2)/ss,tri(:,3)/ss,'g');
% % plot3(tri2(:,1)/ss,tri2(:,2)/ss,tri2(:,3)/ss,'c');
% hold off
% axis equal;
% axis([-1 1 -1 1 -1 1]);
% xlabel('x');
% ylabel('y');
% zlabel('z');
% grid off



% T = [-1.0000,0,0,0.9426;
%       0,0,1.0000,-0.4945;
%       0,-1.0000,0,9.1603;
%       0,0,0,1.0000];
% view(T);



